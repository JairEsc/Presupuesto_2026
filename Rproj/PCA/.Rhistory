library(stats)
"../../../Oportunidades_Municipales_Varias_Fuentes/Mapas_Alternos/Temas_usados_indicadores_tend_negativa.csv" |> read.csv()->
indicadores
View(indicadores)
library(sf)
"../../../../Reutilizables/respaldos/Para Eve/indicadores_tendencia_negativa_valores_reales_por_municipio.geojson" |> st_read()->
indicadores
indicadores=indicadores |> st_drop_geometry()
View(indicadores)
pca_indicadores=prcomp(indicadores, scale = TRUE)
"../../../../Reutilizables/respaldos/Para Eve/percepcion_problema_encuesta_post_informe_noviembre2024.geojson" |> st_read()->
indicadores
indicadores=indicadores |> st_drop_geometry()
indicadores= indicadores |> lapply(\(col){
col=gsub("%","",col) |> as.numeric()
})
"../../../../Reutilizables/respaldos/Para Eve/percepcion_problema_encuesta_post_informe_noviembre2024.geojson" |> st_read()->
indicadores
indicadores=indicadores |> st_drop_geometry()
indicadores[,-1]= indicadores[,-1] |> lapply(\(col){
col=gsub("%","",col) |> as.numeric()
})
pca_indicadores=prcomp(indicadores[,-1], scale = TRUE)
summary(pca_indicadores)
pca_indicadores$rotation
pca_indicadores$loadings
install.packages("FactoMineR")
#install.packages("FactoMineR")
library("FactoMineR")
####Con la otra librería
data.pca <- FactoMineR::princomp(indicadores[,-1])
fviz_pca_var(pca_indicadores, col.var = "black")
FactoMineR::fviz_pca_var(pca_indicadores, col.var = "black")
#install.packages("FactoMineR")
install.packages("factoextra")
library("factoextra")
"../../Inputs/Catalogo de Variables 2025.xlsx - Tabla Variables Rosas.csv" |> read.csv()->
indicadores
View(indicadores)
#indicadores=indicadores |> st_drop_geometry()
indicadores=indicadores |>
dplyr::select(NOM_MUN,IMN_2020,PORC_C_ALIM,PORC_C_CEV,PORC_POB_IILP,PCDISC_MOT
,PE_INAC,PSINDER,VPH_NODREN,p_sind)
indicadores[,-1]= indicadores[,-1] |> lapply(\(col){
col=gsub("%","",col) |> as.numeric()
})
source("../../../../Reutilizables/Postgres_BUIG/conexion_buig.R")
View(Lista_BUIG)
viviendas_scince_2020municipal=st_read(buig,Lista_BUIG[[313]])
poblacion_scince_2020municipal=st_read(buig,Lista_BUIG[[313]])
View(poblacion_scince_2020municipal)
View(viviendas_scince_2020municipal)
View(poblacion_scince_2020municipal)
poblacion_scince_2020municipal=st_read(buig,Lista_BUIG[[230]])
View(poblacion_scince_2020municipal)
View(Lista_BUIG)
poblacion_scince_2020municipal=poblacion_scince_2020municipal |>
dplyr::select(cve_mun,nomgeo,pob1)
viviendas_scince_2020municipal=viviendas_scince_2020municipal |>
dplyr::select(cve_mun,nomgeo,viv2)
poblacion_scince_2020municipal=poblacion_scince_2020municipal |>
dplyr::select(cve_mun,nomgeo,pob1) |> st_drop_geometry()
viviendas_scince_2020municipal=viviendas_scince_2020municipal |>
dplyr::select(cve_mun,nomgeo,viv2) |> st_drop_geometry()
merge(viviendas_scince_2020municipal|>
dplyr::select(nomgeo,viv2),by.x='NOM_MUN',by.y='nomgeo')
#indicadores=indicadores |> st_drop_geometry()
indicadores=indicadores |>
dplyr::select(NOM_MUN,IMN_2020,PORC_C_ALIM,PORC_C_CEV,PORC_POB_IILP,PCDISC_MOT
,PE_INAC,PSINDER,VPH_NODREN,p_sind)
indicadores=indicadores |>
merge(y=poblacion_scince_2020municipal |>
dplyr::select(nomgeo,pob1),by.x='NOM_MUN',by.y='nomgeo',all.x=T) |>
merge(y=viviendas_scince_2020municipal|>
dplyr::select(nomgeo,viv2),by.x='NOM_MUN',by.y='nomgeo')
View(indicadores)
View(indicadores)
indicadores=indicadores |>
dplyr::mutate(PCDISC_MOT=round(100*(PCDISC_MOT/pob1),4),
PE_INAC=round(100*(PE_INAC/pob1),4),
PSINDER=round(100*(PSINDER/pob1),4),
VPH_NODREN=round(100*(VPH_NODREN/viv2),4))
indicadores=indicadores |>
dplyr::select(-pob1,-viv2)
indicadores=indicadores |>
dplyr::select(-pob1,-viv2)
View(indicadores)
pca_indicadores=prcomp(indicadores[,-1], scale = TRUE)
summary(pca_indicadores)
library("factoextra")
library("FactoMineR")
FactoMineR::fviz_pca_var(pca_indicadores, col.var = "black")
factoextra::fviz_pca_var(pca_indicadores, col.var = "black")
indicadores=indicadores |>
dplyr::select(-pob1,-viv2,p_sind)
indicadores=indicadores |>
dplyr::select(-pob1,-viv2,-p_sind)
"../../Inputs/Catalogo de Variables 2025.xlsx - Tabla Variables Rosas.csv" |> read.csv()->
indicadores
#indicadores=indicadores |> st_drop_geometry()
indicadores=indicadores |>
dplyr::select(NOM_MUN,IMN_2020,PORC_C_ALIM,PORC_C_CEV,PORC_POB_IILP,PCDISC_MOT
,PE_INAC,PSINDER,VPH_NODREN,p_sind)
indicadores[,-1]= indicadores[,-1] |> lapply(\(col){
col=gsub("%","",col) |> as.numeric()
})
##Para adimensionalizar las que faltan usamos poblacion total y número de viviendas habitadas
source("../../../../Reutilizables/Postgres_BUIG/conexion_buig.R")
viviendas_scince_2020municipal=st_read(buig,Lista_BUIG[[313]])
poblacion_scince_2020municipal=st_read(buig,Lista_BUIG[[313]])
poblacion_scince_2020municipal=poblacion_scince_2020municipal |>
dplyr::select(cve_mun,nomgeo,pob1) |> st_drop_geometry()
"../../Inputs/Catalogo de Variables 2025.xlsx - Tabla Variables Rosas.csv" |> read.csv()->
indicadores
#indicadores=indicadores |> st_drop_geometry()
indicadores=indicadores |>
dplyr::select(NOM_MUN,IMN_2020,PORC_C_ALIM,PORC_C_CEV,PORC_POB_IILP,PCDISC_MOT
,PE_INAC,PSINDER,VPH_NODREN,p_sind)
indicadores[,-1]= indicadores[,-1] |> lapply(\(col){
col=gsub("%","",col) |> as.numeric()
})
viviendas_scince_2020municipal=st_read(buig,Lista_BUIG[[313]])
poblacion_scince_2020municipal=st_read(buig,Lista_BUIG[[313]])
poblacion_scince_2020municipal=poblacion_scince_2020municipal |>
dplyr::select(cve_mun,nomgeo,pob1) |> st_drop_geometry()
View(indicadores)
View(poblacion_scince_2020municipal)
viviendas_scince_2020municipal=st_read(buig,Lista_BUIG[[313]])
poblacion_scince_2020municipal=st_read(buig,Lista_BUIG[[313]])
poblacion_scince_2020municipal=poblacion_scince_2020municipal |>
dplyr::select(cve_mun,nomgeo,pob1) |> st_drop_geometry()
poblacion_scince_2020municipal=st_read(buig,Lista_BUIG[[230]])
poblacion_scince_2020municipal=poblacion_scince_2020municipal |>
dplyr::select(cve_mun,nomgeo,pob1) |> st_drop_geometry()
viviendas_scince_2020municipal=viviendas_scince_2020municipal |>
dplyr::select(cve_mun,nomgeo,viv2) |> st_drop_geometry()
indicadores=indicadores |>
merge(y=poblacion_scince_2020municipal |>
dplyr::select(nomgeo,pob1),by.x='NOM_MUN',by.y='nomgeo',all.x=T) |>
merge(y=viviendas_scince_2020municipal|>
dplyr::select(nomgeo,viv2),by.x='NOM_MUN',by.y='nomgeo')
indicadores=indicadores |>
dplyr::mutate(PCDISC_MOT=round(100*(PCDISC_MOT/pob1),4),
PE_INAC=round(100*(PE_INAC/pob1),4),
PSINDER=round(100*(PSINDER/pob1),4),
VPH_NODREN=round(100*(VPH_NODREN/viv2),4))
indicadores=indicadores |>
dplyr::select(-pob1,-viv2,-p_sind)
pca_indicadores=prcomp(indicadores[,-1], scale = TRUE)
summary(pca_indicadores)
factoextra::fviz_pca_var(pca_indicadores, col.var = "black")
source("~/Jair/Repositorios/Presupuesto_2026/Rproj/Codigos/pre-procesamiento.R", echo=TRUE)
pca_indicadores=prcomp(indicadores[,-1], scale = TRUE)
summary(pca_indicadores)
pca_indicadores$rotation
##Exploramos correlaciones
library(ggcorrplot)
ggcorrplot::ggcorrplot(corr = cor(indicadores[,-1]))
ggcorrplot::ggcorrplot(corr = cor(indicadores[,-1]),type = "lower",show.diag = F,lab = T)
View(Lista_BUIG)
st_read(buig,Lista_BUIG[[26]])->areas_verdes
areas_verdes |> st_geometry() |> plot()
View(areas_verdes)
"../../../Espacios_públicos/Datos/Espacios Publicos/Parques_Jardines_Poligonos.shp" |> read_sf() |> st_geometry() |> plot()
"../../../Espacios_públicos/Datos/Espacios Publicos/Espacios Publicos/Plazas_Parques_Jardines.shp" |> read_sf() |> st_geometry() |> plot()
"../../../Espacios_públicos/Datos/Espacios Publicos/Espacios Publicos/Parques_Jardines_Poligonos.shp" |> read_sf() |> st_geometry() |> plot()
indicadores |> openxlsx::write.xlsx("../Datos/municipal_8_indicadores.xlsx")
"../../../../ASUS Gamer Jair/Complejidad económica/DENUE 2024 masiva/"
1000*1000
2.15433e-7
2.15433e-7/(1000*1000)
2.15433e-7*(1000*1000)
1000*1000
"../../Inputs/Catalogo de Variables 2025.xlsx - Tabla Variables Rosas.csv" |> read.csv()->
indicadores
View(indicadores)
#indicadores=indicadores |> st_drop_geometry()
indicadores=indicadores |>
dplyr::select(-CVE_EST:CVE_MUN,-can_xhab,-A_ve_m2,-u_pp,-ec_co2e)
"../../Inputs/Catalogo de Variables 2025.xlsx - Tabla Variables Rosas.csv" |> read.csv()->
indicadores
#indicadores=indicadores |> st_drop_geometry()
indicadores=indicadores |>
dplyr::select(c(-CVE_EST:CVE_MUN,-can_xhab,-A_ve_m2,-u_pp,-ec_co2e))
"../../Inputs/Catalogo de Variables 2025.xlsx - Tabla Variables Rosas.csv" |> read.csv()->
indicadores
#indicadores=indicadores |> st_drop_geometry()
indicadores=indicadores |>
dplyr::select(c(-CVE_EST,CVE_MUN,NOM_EST,-can_xhab,-A_ve_m2,-u_pp,-ec_co2e))
View(indicadores)
"../../Inputs/Catalogo de Variables 2025.xlsx - Tabla Variables Rosas.csv" |> read.csv()->
indicadores
#indicadores=indicadores |> st_drop_geometry()
indicadores=indicadores |>
dplyr::select(c(-CVE_EST,-CVE_MUN,-NOM_EST,-can_xhab,-A_ve_m2,-u_pp,-ec_co2e))
View(indicadores)
"../../Inputs/Catalogo de Variables 2025.xlsx - Tabla Variables Rosas.csv" |> read.csv()->
indicadores
#indicadores=indicadores |> st_drop_geometry()
indicadores=indicadores |>
dplyr::select(c(-CVE_EST,-CVE_MUN,-NOM_EST,PSINDER,-can_xhab,-A_ve_m2,-u_pp,-ec_co2e))
"../../Inputs/Catalogo de Variables 2025.xlsx - Tabla Variables Rosas.csv" |> read.csv()->
indicadores
#indicadores=indicadores |> st_drop_geometry()
indicadores=indicadores |>
dplyr::select(c(-CVE_EST,-CVE_MUN,-NOM_EST,-PSINDER,-can_xhab,-A_ve_m2,-u_pp,-ec_co2e))
source("../../../../Reutilizables/Postgres_BUIG/conexion_buig.R")
viviendas_scince_2020municipal=st_read(buig,Lista_BUIG[[313]])
poblacion_scince_2020municipal=st_read(buig,Lista_BUIG[[230]])
poblacion_scince_2020municipal=poblacion_scince_2020municipal |>
dplyr::select(cve_mun,nomgeo,pob1) |> st_drop_geometry()
viviendas_scince_2020municipal=viviendas_scince_2020municipal |>
dplyr::select(cve_mun,nomgeo,viv2) |> st_drop_geometry()
indicadores=indicadores |>
merge(y=poblacion_scince_2020municipal |>
dplyr::select(nomgeo,pob1),by.x='NOM_MUN',by.y='nomgeo',all.x=T) |>
merge(y=viviendas_scince_2020municipal|>
dplyr::select(nomgeo,viv2),by.x='NOM_MUN',by.y='nomgeo')
View(indicadores)
indicadores=indicadores |>
dplyr::mutate(rsu_sin_rec=as.numeric(gsub(",","",rsu_sin_rec))/pob1,
VPH_NODREN=100*(VPH_NODREN/viv2),
100*personal_seguridad/pob1,
TOT_INV_CARR=TOT_INV_CARR/pob1,
TOT_INV_AGUA=TOT_INV_AGUA/pob1,
TOT_INV_ESPE=TOT_INV_ESPE/pob1,
SPDCD_T=as.numeric(SPDCD_T),
t_lamp_lumi_alumb_pub=as.numeric(gsub(" ","",t_lamp_lumi_alumb_pub)),
p_disp_seg=as.numeric(gsub(" ","",p_disp_seg)),
pres_eje_seg_mun=as.numeric(gsub(" ","",pres_eje_seg_mun))
)
View(indicadores)
"../../Inputs/Catalogo de Variables 2025.xlsx - Tabla Variables Rosas.csv" |> read.csv()->
indicadores
#indicadores=indicadores |> st_drop_geometry()
indicadores=indicadores |>
dplyr::select(c(-CVE_EST,-CVE_MUN,-NOM_EST,-PSINDER,-can_xhab,-A_ve_m2,-u_pp,-ec_co2e))
indicadores=indicadores |>
merge(y=poblacion_scince_2020municipal |>
dplyr::select(nomgeo,pob1),by.x='NOM_MUN',by.y='nomgeo',all.x=T) |>
merge(y=viviendas_scince_2020municipal|>
dplyr::select(nomgeo,viv2),by.x='NOM_MUN',by.y='nomgeo')
indicadores=indicadores |>
dplyr::mutate(rsu_sin_rec=as.numeric(gsub(",","",rsu_sin_rec))/pob1,
VPH_NODREN=100*(VPH_NODREN/viv2),
personal_seguridad=1000*personal_seguridad/pob1,
TOT_INV_CARR=TOT_INV_CARR/pob1,
TOT_INV_AGUA=TOT_INV_AGUA/pob1,
TOT_INV_ESPE=TOT_INV_ESPE/pob1,
SPDCD_T=as.numeric(SPDCD_T),
t_lamp_lumi_alumb_pub=as.numeric(gsub(" ","",t_lamp_lumi_alumb_pub)),
p_disp_seg=as.numeric(gsub(" ","",p_disp_seg)),
pres_eje_seg_mun=as.numeric(gsub(" ","",pres_eje_seg_mun))
)
View(indicadores)
indicadores[,-1]= indicadores[,-1] |> lapply(\(col){
col=gsub("%","",col) |> as.numeric()
})
View(indicadores)
indicadores=indicadores |>
dplyr::mutate(PCDISC_MOT=round(100*(PCDISC_MOT/pob1),4),
PE_INAC=round(100*(PE_INAC/pob1),4),
PSINDER=round(100*(PSINDER/pob1),4),
VPH_NODREN=round(100*(VPH_NODREN/viv2),4))
indicadores=indicadores |>
dplyr::mutate(PCDISC_MOT=round(100*(PCDISC_MOT/pob1),4),
PE_INAC=round(100*(PE_INAC/pob1),4),
VPH_NODREN=round(100*(VPH_NODREN/viv2),4))
indicadores=indicadores |>
dplyr::select(-pob1,-viv2,-p_sind)
View(indicadores)
source("~/Jair/Repositorios/Presupuesto_2026/Rproj/Codigos/pre-procesamiento.R", echo=TRUE)
ggcorrplot::ggcorrplot(corr = cor(indicadores[,-1]),type = "lower",show.diag = F,lab = T)
indicadores |> openxlsx::write.xlsx("../Datos/municipal_30_indicadores.xlsx")
pca_indicadores=prcomp(indicadores[,-1], scale = TRUE)
summary(pca_indicadores)
prcomp(indicadores[,-1], scale = TRUE)
indicadores |> lapply(class)
indicadores |> lapply(sd)
indicadores |> lapply(\(x){sd(x,na.rm = T)})
pca_indicadores=NULL
pca_indicadores=prcomp(indicadores[,-1], scale = TRUE)
indicadores |> lapply(\(x){
x[is.na(x)]=0
})
indicadores=indicadores |>
dplyr::mutate(dplyr::across(c(GINI, pres_eje_seg_mun), ~replace_na(., 0)))
indicadores=indicadores |>
dplyr::mutate(dplyr::across(c(GINI, pres_eje_seg_mun), ~dplyr::replace_na(., 0)))
indicadores=indicadores |>
dplyr::mutate(dplyr::across(c(GINI, pres_eje_seg_mun), ~replace(., 0)))
indicadores=indicadores |>
dplyr::mutate(dplyr::across(GINI:pres_eje_seg_mun, ~replace(., 0)))
indicadores=indicadores |>
dplyr::mutate(dplyr::across(GINI:pres_eje_seg_mun, ~tidyr::replace_na(., 0)))
View(indicadores)
ggcorrplot::ggcorrplot(corr = cor(indicadores[,-1]),type = "lower",show.diag = F,lab = T)
pca_indicadores=prcomp(indicadores[,-1], scale = TRUE)
summary(pca_indicadores)
pca_indicadores$rotation
####Con la otra librería
factoextra::fviz_pca_var(pca_indicadores, col.var = "black")
pca_indicadores$rotation
summary(pca_indicadores)
pca_indicadores$rotation
ggcorrplot::ggcorrplot(corr = cor(indicadores[,-1]),type = "lower",show.diag = F,lab = T)
"../../Inputs/Catalogo de Variables 2025.xlsx - vars previas.csv" |> read.csv()->diccionario_variables
View(diccionario_variables)
View(poblacion_scince_2020municipal)
save.image("~/Jair/Repositorios/Presupuesto_2026/Rproj/PCA/.RData")
